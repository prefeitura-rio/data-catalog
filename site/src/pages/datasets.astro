---
import BaseLayout from '../layouts/BaseLayout.astro';
import SearchBar from '../components/SearchBar.astro';
import { getDatasets } from '../utils/catalog.js';

const datasets = getDatasets().sort((a, b) => a.name.localeCompare(b.name));
---
<BaseLayout title="Lista de Datasets">
	<div class="text-center mb-8">
		<h1 class="text-3xl font-bold text-gray-800 mb-2">Lista Completa de Datasets</h1>
		<p class="text-gray-600">Visualização de todos os conjuntos de dados disponíveis no catálogo.</p>
	</div>

	<div class="flex justify-center gap-8 mb-8 flex-wrap">
		<div class="text-center">
			<div class="text-2xl font-bold text-blue-600">{datasets.length}</div>
			<div class="text-sm text-gray-500">Datasets</div>
		</div>
		<div class="text-center">
			<div class="text-2xl font-bold text-blue-600">{datasets.reduce((sum, d) => sum + d.tableCount, 0)}</div>
			<div class="text-sm text-gray-500">Total de Tabelas</div>
		</div>
	</div>

	<div class="flex gap-4 mb-8 items-center flex-wrap justify-center">
		<SearchBar
			placeholder="Pesquisar por nome, descrição ou tabelas..."
			containerClass="flex-1 min-w-80 max-w-2xl mx-auto"
		/>
	</div>

	<div class="flex flex-col gap-4" id="datasets-list" data-pagefind-body>
		{datasets.map(dataset => (
			<article class="flex flex-col md:flex-row md:justify-between md:items-center p-6 bg-white border border-gray-200 rounded-lg transition-transform hover:-translate-y-0.5 hover:shadow-lg">
				<div class="flex-1 min-w-0">
					<header class="mb-3">
						<h3 class="text-xl font-semibold mb-2">
							<a href={`/${dataset.name}/`} data-pagefind-meta="title" class="text-blue-600 hover:underline">{dataset.name}</a>
						</h3>
						<div class="text-sm text-gray-500">
							{dataset.tableCount} tabela{dataset.tableCount !== 1 ? 's' : ''} •
							Atualizado em {new Date(dataset.lastUpdated).toLocaleDateString('pt-BR')}
						</div>
					</header>
					<p class="text-gray-700 leading-relaxed" data-pagefind-meta="description">
						{dataset.description || 'Sem descrição disponível'}
					</p>
				</div>
				<div class="shrink-0 mt-4 md:mt-0 md:ml-6">
					<a href={`/${dataset.name}/`} class="inline-flex items-center gap-2 px-4 py-2 border border-blue-600 text-blue-600 rounded-md hover:bg-blue-600 hover:text-white transition-colors whitespace-nowrap w-full md:w-auto justify-center">
						Ver Tabelas <i data-lucide="arrow-right"></i>
					</a>
				</div>
			</article>
		))}
	</div>

	<link href="/pagefind/pagefind-ui.css" rel="stylesheet">
	<script is:inline src="/pagefind/pagefind-ui.js"></script>
</BaseLayout>
