---
import { ArrowRight } from '@lucide/astro';
import BaseLayout from '../layouts/BaseLayout.astro';
import SearchBar from '../components/SearchBar.astro';
import StatsDisplay from '../components/StatsDisplay.astro';
import Button from '../components/Button.astro';
import PagefindAssets from '../components/PagefindAssets.astro';
import { getDatasetsSorted } from '../scripts/catalog.js';
import { getDatasetsPageStats } from '../scripts/stats.js';

const datasets = getDatasetsSorted();
const stats = getDatasetsPageStats();
---
<BaseLayout title="Lista de Datasets">
	<div class="text-center mb-8">
		<h1 class="text-3xl font-bold text-gray-800 mb-2">Lista Completa de Datasets</h1>
		<p class="text-gray-600">Visualização de todos os conjuntos de dados disponíveis no catálogo.</p>
	</div>

	<StatsDisplay
		stats={stats}
		containerClass="flex justify-center gap-8 mb-8 flex-wrap"
		statClass="text-center"
	/>

	<div class="flex gap-4 mb-8 items-center flex-wrap justify-center">
		<SearchBar
			placeholder="Pesquisar por nome, descrição ou tabelas..."
			containerClass="flex-1 min-w-80 max-w-2xl mx-auto"
		/>
	</div>

	<div class="flex flex-col gap-4" id="datasets-list" data-pagefind-body>
		{datasets.map(dataset => (
			<article class="flex flex-col md:flex-row md:justify-between md:items-center p-6 bg-white border border-gray-200 rounded-lg transition-transform hover:-translate-y-0.5 hover:shadow-lg">
				<div class="flex-1 min-w-0">
					<header class="mb-3">
						<h3 class="text-xl font-semibold mb-1">
							<a href={`/${dataset.name}/`} data-pagefind-meta="title" class="text-blue-600 hover:underline">{dataset.name}</a>
						</h3>
						<div class="mb-2">
							<span class="inline-block px-2 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded-full">
								{dataset.project}
							</span>
						</div>
						<div class="text-sm text-gray-500">
							{dataset.tableCount} tabela{dataset.tableCount !== 1 ? 's' : ''} •
							Atualizado em {new Date(dataset.lastUpdated).toLocaleDateString('pt-BR')}
						</div>
					</header>
					<p class="text-gray-700 leading-relaxed" data-pagefind-meta="description">
						{dataset.description || 'Sem descrição disponível'}
					</p>
				</div>
				<div class="shrink-0 mt-4 md:mt-0 md:ml-6">
					<Button
						variant="secondary"
						href={`/${dataset.name}/`}
						class="whitespace-nowrap w-full md:w-auto justify-center"
					>
						Ver Tabelas <ArrowRight />
					</Button>
				</div>
			</article>
		))}
	</div>

	<PagefindAssets />
</BaseLayout>
