---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getStaticPaths, getTotalColumns } from '../utils/schema.js';
import { prepareDatasetTablesForRender } from '../utils/rendering.js';

export { getStaticPaths };

const { dataset } = Astro.props;
const tableRenderData = prepareDatasetTablesForRender(dataset.tables);
---
<BaseLayout title={dataset.name}>
	<header data-pagefind-body>
		<div class="mb-6">
			<a href="/datasets/" class="inline-flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 text-blue-600 rounded-md hover:bg-blue-600 hover:text-white transition-all hover:-translate-x-0.5 text-sm">
				<i data-lucide="arrow-left"></i> Voltar à Lista de Datasets
			</a>
		</div>

		<div class="text-center">
			<h1 class="text-3xl font-bold text-gray-800 mb-4" data-pagefind-meta="title">{dataset.name}</h1>
			<p class="text-lg text-gray-600 mb-8" data-pagefind-meta="description">
				{dataset.description || 'Sem descrição disponível'}
			</p>

			<div class="flex justify-center gap-8 mb-8">
				<div class="text-center">
					<div class="text-2xl font-bold text-blue-600 mb-1">{dataset.tables.length}</div>
					<div class="text-sm text-gray-500">Tabela{dataset.tables.length !== 1 ? 's' : ''}</div>
				</div>
				<div class="text-center">
					<div class="text-2xl font-bold text-blue-600 mb-1">
						{getTotalColumns(dataset.tables)}
					</div>
					<div class="text-sm text-gray-500">Colunas Totais</div>
				</div>
			</div>
		</div>
	</header>
	{tableRenderData.map((tableData) => (
		<article class="mb-8" data-pagefind-body>
			<header class="mb-4">
				<h2 class="text-2xl font-semibold text-gray-800 mb-2" data-pagefind-meta="table_name">{tableData.name}</h2>
				<p class="text-sm text-gray-500">
					{tableData.columnCount} colunas •
					Criado em {tableData.formattedDate}
				</p>
			</header>

			<figure class="overflow-x-auto">
				<table class="w-full bg-white border border-gray-200 rounded-lg overflow-hidden">
					<thead class="bg-gray-50">
						<tr>
							<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nome da Coluna</th>
							<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tipo</th>
							<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Descrição</th>
						</tr>
					</thead>
					<tbody class="divide-y divide-gray-200">
						{tableData.schemaEntries.map((column) => (
							<tr class="hover:bg-gray-50">
								<td class="px-6 py-4 whitespace-nowrap"><code class="font-mono font-semibold text-gray-900" data-pagefind-meta="column_name">{column.name}</code></td>
								<td class="px-6 py-4 whitespace-nowrap"><span class="inline-flex items-center px-2.5 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800 font-mono" data-pagefind-meta="column_type">{column.type}</span></td>
								<td class="px-6 py-4 text-sm text-gray-700" data-pagefind-meta="column_description">{column.description}</td>
							</tr>
						))}
					</tbody>
				</table>
			</figure>
		</article>
	))}
</BaseLayout>
